- provide(:title, @country.name_common)

.page-header
  .row
    .col-sm-6
      %h1= @country.name_common
      = image_tag(@country.flag_image_path, style: 'height: 32px;')
      = visit_label(@country)
    .col-sm-6
      .visible-xs
        %hr
      = link_to new_checkin_path(country: @country.cca2), class: 'btn btn-labeled btn-primary pull-right' do
        %span
          %i.fas.fa-plus.font-size-11
          Add checkin
.row
  .col.col-md-6
    #mapbox.mapbox{ data: { country_geojson: @geojson, country_cca3: @country.cca3, country_lat: @country.latitude, country_lng: @country.longitude } }
    .visible-xs.padding-sm
  .col.col-md-6
    = render 'countries/show/country_details', country: @country
    = render 'countries/show/geographical_details', country: @country
    = render 'countries/show/miscellaneous_details', country: @country

- content_for :js do
  :javascript
    mapboxgl.accessToken = "#{ENV.fetch('MAPBOX_KEY')}";
    var mapboxSelector = document.querySelector('#mapbox');

    var map = new mapboxgl.Map({
        container: 'mapbox', // container id
        style: 'mapbox://styles/mapbox/streets-v9', //stylesheet location
        center: [mapboxSelector.dataset.countryLng, mapboxSelector.dataset.countryLat], // starting position
        zoom: 4 // starting zoom
    });

    var nav = new mapboxgl.NavigationControl({position: 'bottom-right'}); // position is optional
    map.addControl(nav);

    map.on('load', function() {
      getCountry(map)
    });

    function getCountry(map) {
      var geojson = $.parseJSON(mapboxSelector.dataset.countryGeojson);
      map.addSource(mapboxSelector.dataset.countryCca3, {
        'type': 'geojson',
        'data': geojson
      });

      map.addLayer({
        'id': 'route',
        'type': 'fill',
        'source': mapboxSelector.dataset.countryCca3,
        'layout': {},
        'paint': {
            'fill-color': '#088',
            'fill-opacity': 0.8
        }
      });

      var bbox = turf.extent(geojson);

      map.fitBounds(bbox, {padding: 20});
    }
